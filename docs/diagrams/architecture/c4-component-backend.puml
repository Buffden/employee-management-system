@startuml Component Diagram
' Workflow test - updated
skinparam componentStyle rectangle
skinparam linetype ortho
skinparam backgroundColor #FFFFFF

title Spring Boot Backend API - Component Diagram

package "Spring Boot API Container" #LightYellow {
  
  package "Controller Layer" #LightBlue {
    [Employee Controller] as EmpCtrl
    [Department Controller] as DeptCtrl
    [Project Controller] as ProjCtrl
    [Task Controller] as TaskCtrl
    [Dashboard Controller] as DashCtrl
    [Auth Controller] as AuthCtrl
  }
  
  package "Service Layer" #LightGreen {
    [Employee Service] as EmpSvc
    [Department Service] as DeptSvc
    [Project Service] as ProjSvc
    [Task Service] as TaskSvc
    [Dashboard Facade Service] as DashSvc
    [Auth Service] as AuthSvc
  }
  
  package "Security Layer" #LightPink {
    [Security Config] as SecConfig
    [JWT Authentication Filter] as JwtFilter
    [Security Service] as SecSvc
    [User Details Service] as UserDetailsSvc
  }
  
  package "Repository Layer" #LightCoral {
    [Employee Repository] as EmpRepo
    [Department Repository] as DeptRepo
    [Project Repository] as ProjRepo
    [Task Repository] as TaskRepo
  }
  
  package "Mapper Layer" #LightGray {
    [Employee Mapper] as EmpMapper
    [Department Mapper] as DeptMapper
    [Project Mapper] as ProjMapper
    [Task Mapper] as TaskMapper
  }
  
  package "Metric Services" #LightYellow {
    [Metric Factory] as MetricFactory
    [Total Employees Metric] as TotalMetric
    [Average Salary Metric] as AvgMetric
  }
}

database "PostgreSQL Database" as DB

EmpCtrl --> EmpSvc : uses
DeptCtrl --> DeptSvc : uses
ProjCtrl --> ProjSvc : uses
TaskCtrl --> TaskSvc : uses
DashCtrl --> DashSvc : uses
AuthCtrl --> AuthSvc : uses

' Security Layer Relationships
JwtFilter --> UserDetailsSvc : uses
JwtFilter --> SecSvc : uses
SecConfig --> JwtFilter : configures
UserDetailsSvc --> UserRepo : uses

' Service to Security relationships (RBAC)
EmpSvc ..> SecSvc : uses (RBAC)
DeptSvc ..> SecSvc : uses (RBAC)
ProjSvc ..> SecSvc : uses (RBAC)
TaskSvc ..> SecSvc : uses (RBAC)
DashSvc ..> SecSvc : uses (RBAC)

EmpSvc --> EmpRepo : uses
DeptSvc --> DeptRepo : uses
ProjSvc --> ProjRepo : uses
TaskSvc --> TaskRepo : uses
AuthSvc --> UserRepo : uses

EmpSvc --> EmpMapper : uses
DeptSvc --> DeptMapper : uses
ProjSvc --> ProjMapper : uses
TaskSvc --> TaskMapper : uses

DashSvc --> MetricFactory : uses
MetricFactory --> TotalMetric : creates
MetricFactory --> AvgMetric : creates

EmpRepo --> DB : reads/writes
DeptRepo --> DB : reads/writes
ProjRepo --> DB : reads/writes
TaskRepo --> DB : reads/writes
UserRepo --> DB : reads/writes

note right of DashSvc
  **Pattern:** Facade
  **Purpose:** Simplifies access to
  multiple metric services
end note

note right of MetricFactory
  **Pattern:** Factory Method
  **Purpose:** Creates metric services
end note

note right of TotalMetric
  **Pattern:** Strategy
  **Purpose:** Different calculation
  strategies
end note

note right of SecSvc
  **RBAC Helper:**
  - Role-based access checks
  - Department scope validation
  - Used in @PreAuthorize SpEL
  - See: docs/lld/auth-module.md
end note

note right of JwtFilter
  **Security Filter:**
  - Validates JWT tokens
  - Extracts role from claims
  - Sets SecurityContext
  - Applied before all requests
end note

@enduml
