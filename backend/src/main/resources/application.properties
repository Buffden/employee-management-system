# PostgreSQL Configuration
# All credentials must be provided via environment variables or .env file
# Required: DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PWD
# Optional: DB_SSL_MODE (default: disable for dev, use 'require' or 'verify-full' for production)
spring.datasource.url=jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}?sslmode=${DB_SSL_MODE:disable}&connectTimeout=30
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PWD}

# Hibernate Configuration
# IMPORTANT: ddl-auto is set to 'none' - use Flyway for schema changes
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true

# Flyway Configuration (Industrial Database Migration Tool)
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true

# CORS Configuration
# NOTE: CORS is primarily configured in SecurityConfig.java
# These properties are for reference/fallback only
# Set CORS_ALLOWED_ORIGINS in .env file (comma-separated for multiple origins)
spring.web.cors.allowed-origins=${CORS_ALLOWED_ORIGINS}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
# Headers are restricted in SecurityConfig - this is fallback only
spring.web.cors.allowed-headers=Authorization,Content-Type,X-Requested-With,Accept,Origin,Cache-Control
spring.web.cors.allow-credentials=true

# Connection Pooling (HikariCP)
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.max-lifetime=1800000

# Health Check & Management
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=${HEALTH_SHOW_DETAILS:when-authorized}
management.metrics.enable.process=false

# Logging (can be overridden by profile-specific properties)
logging.level.org.hibernate.SQL=${HIBERNATE_SQL_LOG_LEVEL:DEBUG}
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=${HIBERNATE_BINDER_LOG_LEVEL:TRACE}

# JWT Configuration
# IMPORTANT: Set JWT_SECRET_KEY in .env file!
# Generate a secure key: openssl rand -base64 64
jwt.secret.key=${JWT_SECRET_KEY}
jwt.access.token.expiration=86400000
jwt.refresh.token.expiration=604800000

# Jackson Configuration for LocalDateTime serialization
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.default-property-inclusion=NON_NULL

# Frontend Configuration (for email links)
app.frontend.base-url=${FRONTEND_BASE_URL}

# Email Service Configuration
email.service.provider=${EMAIL_SERVICE_PROVIDER:demo}

# SendGrid Configuration (Free tier: 100 emails/day)
email.sendgrid.api-key=${EMAIL_SENDGRID_API_KEY:}
email.sendgrid.from-email=${EMAIL_SENDGRID_FROM_EMAIL:}
email.sendgrid.from-name=${EMAIL_SENDGRID_FROM_NAME:Employee Management System}

# Error Handling Configuration
app.error.show-details=${ERROR_SHOW_DETAILS:true}

# Request Size Limits (DoS Protection)
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
server.tomcat.max-http-post-size=10MB

# Rate Limiting Configuration
# Login endpoint: 5 requests per 15 minutes (900 seconds) per IP
rate.limit.login.requests=5
rate.limit.login.window=900
# General API: 100 requests per minute (60 seconds) per IP
rate.limit.api.requests=100
rate.limit.api.window=60

# Admin User Initialization Configuration
# SECURITY: Only enable in development or when explicitly needed
# Set these in .env file (DO NOT commit to version control)
app.admin.create=${ADMIN_CREATE:false}
app.admin.username=${ADMIN_USERNAME:}
app.admin.password=${ADMIN_PASSWORD:}
app.admin.email=${ADMIN_EMAIL:ems.buffden@gmail.com}
